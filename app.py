import streamlit as st
import pandas as pd
from catboost import CatBoostClassifier

# โโโ ะะฐะณััะทะบะฐ ะผะพะดะตะปะธ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
@st.cache_resource
def load_model():
    model = CatBoostClassifier()
    model.load_model('phishing_detector_catboost.cbm')
    return model

model = load_model()

# โโโ ะกะฟะธัะพะบ ะฑะฐะทะพะฒัั ะฟัะธะทะฝะฐะบะพะฒ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
base_features = [
    'having_IP_Address', 'URL_Length', 'having_At_Symbol', 'Prefix_Suffix',
    'having_Sub_Domain', 'SSLfinal_State', 'Domain_registeration_length', 'port',
    'Request_URL', 'URL_of_Anchor', 'Links_in_tags', 'SFH',
    'Submitting_to_email', 'Abnormal_URL', 'on_mouseover', 'age_of_domain',
    'DNSRecord', 'web_traffic', 'Page_Rank', 'Google_Index',
    'Links_pointing_to_page', 'Statistical_report'
]

# โโโ ะะพะดัะพะฑะฝัะต ะพะฟะธัะฐะฝะธั ะฟัะธะทะฝะฐะบะพะฒ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
feature_descriptions = {
    'having_IP_Address': 'ะััั ะปะธ IP-ะฐะดัะตั ะฒะผะตััะพ ะดะพะผะตะฝะฐ ะฒ URL?',
    'URL_Length': 'ะะปะธะฝะฐ URL (ะพัะตะฝั ะดะปะธะฝะฝัะต โ ะฟะพะดะพะทัะธัะตะปัะฝั)',
    'having_At_Symbol': 'ะััั ะปะธ ัะธะผะฒะพะป @ ะฒ URL?',
    'Prefix_Suffix': 'ะััั ะปะธ ะดะตัะธั (-) ะฒ ะดะพะผะตะฝะฝะพะผ ะธะผะตะฝะธ?',
    'having_Sub_Domain': 'ะะพะปะธัะตััะฒะพ ะฟะพะดะดะพะผะตะฝะพะฒ (ะผะฝะพะณะพ โ ะฟะพะดะพะทัะธัะตะปัะฝะพ)',
    'SSLfinal_State': 'ะะฐัะตััะฒะพ SSL-ัะตััะธัะธะบะฐัะฐ (-1 โ ะฟะปะพัะพะน/ะพััััััะฒัะตั)',
    'Domain_registeration_length': 'ะกัะพะบ ัะตะณะธัััะฐัะธะธ ะดะพะผะตะฝะฐ (ะบะพัะพัะบะธะน โ ะฟะพะดะพะทัะธัะตะปัะฝะพ)',
    'port': 'ะัะฟะพะปัะทัะตััั ะปะธ ะฝะตััะฐะฝะดะฐััะฝัะน ะฟะพัั?',
    'Request_URL': '% ะฒะฝะตัะฝะธั ัะตััััะพะฒ ะฒ ะทะฐะฟัะพัะฐั',
    'URL_of_Anchor': '% ะฟะพะดะพะทัะธัะตะปัะฝัั ัััะปะพะบ ะฒ ัะบะพััั (<a> ัะตะณะธ)',
    'Links_in_tags': '% ะฟะพะดะพะทัะธัะตะปัะฝัั ัััะปะพะบ ะฒ ะผะตัะฐ-ัะตะณะฐั',
    'SFH': 'Server Form Handler (ะบัะดะฐ ะพัะฟัะฐะฒะปัะตััั ัะพัะผะฐ)',
    'Submitting_to_email': 'ะัะฟัะฐะฒะบะฐ ัะพัะผั ะฝะฐ email?',
    'Abnormal_URL': 'ะะฝะพะผะฐะปะธะธ ะฒ ััััะบัััะต URL',
    'on_mouseover': 'ะะทะผะตะฝัะตััั ะปะธ status bar ะฟัะธ ะฝะฐะฒะตะดะตะฝะธะธ ะผััะธ?',
    'age_of_domain': 'ะะพะทัะฐัั ะดะพะผะตะฝะฐ (ะผะพะปะพะดะพะน โ ะฟะพะดะพะทัะธัะตะปัะฝะพ)',
    'DNSRecord': 'ะััั ะปะธ ะทะฐะฟะธัั ะฒ DNS?',
    'web_traffic': 'ะะพะฟัะปััะฝะพััั ัะฐะนัะฐ ะฟะพ ััะฐัะธะบั',
    'Page_Rank': 'PageRank ะพั Google',
    'Google_Index': 'ะัะพะธะฝะดะตะบัะธัะพะฒะฐะฝ ะปะธ ัะฐะนั Google?',
    'Links_pointing_to_page': 'ะะพะปะธัะตััะฒะพ ะฒะฝะตัะฝะธั ัััะปะพะบ ะฝะฐ ัััะฐะฝะธัั',
    'Statistical_report': 'ะััั ะปะธ ะฒ ะพััััะฐั ะพ ัะธัะธะฝะณะต?'
}

# โโโ ะคัะฝะบัะธั ัะพะทะดะฐะฝะธั ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะฟัะธะทะฝะฐะบะพะฒ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
def add_engineered_features(df):
    df = df.copy()
    df['total_red_flags'] = (df == '-1').sum(axis=1).astype(str)
    df['ssl_anchor_interaction'] = (df['SSLfinal_State'].astype(int) *
                                    df['URL_of_Anchor'].astype(int)).astype(str)
    df['no_ssl_short_reg'] = ((df['SSLfinal_State'] == '-1') &
                              (df['Domain_registeration_length'] == '-1')).astype(int).astype(str)
    df['subdomain_prefix'] = (df['having_Sub_Domain'].astype(int) *
                              df['Prefix_Suffix'].astype(int)).astype(str)
    return df

# โโโ ะะพะฝัะธะณััะฐัะธั ะฟัะธะปะพะถะตะฝะธั โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
st.set_page_config(page_title="Phishing Detector", layout="wide", page_icon="๐ก๏ธ")

# โโโ ะะพะบะพะฒะฐั ะฟะฐะฝะตะปั โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
st.sidebar.title("๐ก๏ธ Phishing Detector")
st.sidebar.markdown("**ะะฑะฝะฐััะถะตะฝะธะต ัะธัะธะฝะณะพะฒัั ัะฐะนัะพะฒ**")
pages = ["ะะปะฐะฒะฝะฐั", "ะัะพะฒะตัะบะฐ ัะฐะนัะฐ", "ะัะต ะฟัะธะทะฝะฐะบะธ", "ะ ะผะพะดะตะปะธ"]
page = st.sidebar.radio("ะะฐะฒะธะณะฐัะธั", pages)
st.sidebar.markdown("---")
st.sidebar.caption("ะะฑะฑะพัะพะฒ ะััะฐะผะผะฐะดะฐััะพั")
st.sidebar.caption("        ะััะฐะฝะฑะต ะขะพัะธะบะธััะพะฝ")
st.sidebar.caption('                ะฏะฝะฒะฐัะธ ัะพะปะธ 2026')
# ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
if page == "ะะปะฐะฒะฝะฐั":
    st.title("๐ก๏ธ Phishing Detector")

    st.image(
        "photos/7.jpg",
        caption="ะะฐัะธัะฐ ะฒ ัะธััะพะฒะพะผ ะผะธัะต",
        use_column_width=True
    )
    
    st.markdown("""
    ### ะัะธะปะพะถะตะฝะธะต ะดะปั ะฟัะพะฒะตัะบะธ ัะฐะนัะพะฒ ะฝะฐ ัะธัะธะฝะณ
    
    ะญัะพ ะธะฝััััะผะตะฝั ะฝะฐ ะฑะฐะทะต ะผะฐัะธะฝะฝะพะณะพ ะพะฑััะตะฝะธั, ะบะพัะพััะน ะฟะพะผะพะณะฐะตั ะพะฟัะตะดะตะปะธัั,  
    ัะฒะปัะตััั ะปะธ ัะฐะนั ัะธัะธะฝะณะพะฒัะผ ะธะปะธ ะปะตะณะธัะธะผะฝัะผ.
    
    **ะะฐะทัะฐะฑะพััะธะบ:** Muhamadasror Abbosov 
    
    ะะพะดะตะปั ะพะฑััะตะฝะฐ ะฝะฐ ะฑะพะปะตะต ัะตะผ 11 000 **(ะฟะพัะปะต ัะดะฐะปะตะฝะธั ะดัะฑะปัะบะฐัะพะฒ ะผะตะฝััะต)** ะฟัะธะผะตัะฐั ะธ ะฟะพะบะฐะทัะฒะฐะตั ะพัะตะฝั ะฒััะพะบัั ัะพัะฝะพััั.
    
    **ะะตัะตะนะดะธัะต ะฒ ัะฐะทะดะตะป ยซะัะพะฒะตัะบะฐ ัะฐะนัะฐยป**, ััะพะฑั ะฝะฐัะฐัั ะฐะฝะฐะปะธะท!
    """)
    col1, col2 = st.columns(2)
    with col1:
        st.image(
            "photos/3.avif",
            caption="ะะตะทะพะฟะฐัะฝะพะต ัะพะตะดะธะฝะตะฝะธะต",
            use_column_width=True
        )
    
    with col2:
        st.image(
            "photos/4.avif",
            caption="ะกัะตะผั ะพะฑะผะฐะฝะฐ",
            use_column_width=True
        )

#    ััั ัััะฐะฝะธัะฐ ะฟัะพะฒะตัะบะฐ ัะฐะนัะฐ 
elif page == "ะัะพะฒะตัะบะฐ ัะฐะนัะฐ":
    st.title("๐ ะัะพะฒะตัะบะฐ ัะฐะนัะฐ ะฝะฐ ัะธัะธะฝะณ")
    st.image(
        "photos/6.jpg",
        caption="ะัะดััะต ะพััะพัะพะถะฝั ะฒ ะธะฝัะตัะฝะตัะต",
        use_column_width=True
    )    
    st.info("""
    ะะฒะตะดะธัะต ะทะฝะฐัะตะฝะธั ะฟัะธะทะฝะฐะบะพะฒ ัะฐะนัะฐ, ะบะพัะพััะน ัะพัะธัะต ะฟัะพะฒะตัะธัั.  
    ะัะต ะฟัะธะทะฝะฐะบะธ ะทะฐะบะพะดะธัะพะฒะฐะฝั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ:  
    **-1** โ ะฟะพะดะพะทัะธัะตะปัะฝะพ / ะฟะปะพัะพ  
    **0** โ ะฝะตะนััะฐะปัะฝะพ  
    **1** โ ะฝะพัะผะฐะปัะฝะพ / ัะพัะพัะพ
    """)
    
    col1, col2 = st.columns(2)
    input_data = {}
    
    for i, feature in enumerate(base_features):
        with col1 if i % 2 == 0 else col2:
            val = st.selectbox(
                label=feature,
                options=["-1", "0", "1"],
                index=1,
                help=feature_descriptions.get(feature, "ะะฟะธัะฐะฝะธะต ะพััััััะฒัะตั"),
                key=f"input_{feature}"
            )
            input_data[feature] = val
    
    if st.button("๐ ะัะพะฒะตัะธัั ัะฐะนั", type="primary", use_container_width=True):
        with st.spinner("ะะฝะฐะปะธะทะธััั..."):
            input_df = pd.DataFrame([input_data]).astype(str)
            enhanced_df = add_engineered_features(input_df)
            
            try:
                pred = model.predict(enhanced_df)[0]
                proba = model.predict_proba(enhanced_df)[0][1] * 100
                
                if pred == 1:
                    st.error(f"""
                    ### โ๏ธ ะะะะกะะ! ะคะธัะธะฝะณะพะฒัะน ัะฐะนั!
                    ะะตัะพััะฝะพััั ัะธัะธะฝะณะฐ: **{proba:.1f}%**
                    """)
                    st.markdown("**ะะต ะฒะฒะพะดะธัะต** ะปะธัะฝัะต ะดะฐะฝะฝัะต, ะฟะฐัะพะปะธ ะธะปะธ ะฑะฐะฝะบะพะฒัะบะธะต ะบะฐััั!")
                else:
                    st.success(f"""
                    ### โ ะกะฐะนั ะฒัะณะปัะดะธั ะฑะตะทะพะฟะฐัะฝัะผ
                    ะะตัะพััะฝะพััั ัะธัะธะฝะณะฐ: **{proba:.1f}%**
                    """)
                    st.markdown("ะะพ ะฒัะตะณะดะฐ ะฑัะดััะต ะพััะพัะพะถะฝั ะธ ะฟัะพะฒะตััะนัะต ะฐะดัะตั ะธ ัะตััะธัะธะบะฐั ะฒัััะฝัั.")
            except Exception as e:
                st.error("ะัะพะธะทะพัะปะฐ ะพัะธะฑะบะฐ ะฟัะธ ะฟัะตะดัะบะฐะทะฐะฝะธะธ ะผะพะดะตะปะธ")
                st.caption(str(e))

# โโโ ะัะต ะฟัะธะทะฝะฐะบะธ 
elif page == "ะัะต ะฟัะธะทะฝะฐะบะธ":
    st.title("๐ ะะพะดัะพะฑะฝะพะต ะพะฟะธัะฐะฝะธะต ะฒัะตั ะฟัะธะทะฝะฐะบะพะฒ")
    st.markdown("###ะฃ ะฝะฐั ะฒ ะพะฑัะตะผ ะฑัะปะพ ัะฐะผ ะฒ ะดะฐัะฐัะตัะต 30 ะฟัะธะทะฝะฐะบะพะฒ ะผั 5+3 ัะดะฐะปะธะปะธ ะธ +4 ัะผะฝัั ะดะพะฑะฐะฒะธะปะธ ัะฐะบ...")    
    st.markdown("""
    ะะดะตัั ะฟะพะดัะพะฑะฝะพ ะพะฑัััะฝัะตััั **ะบะฐะถะดัะน** ะฟัะธะทะฝะฐะบ ะผะพะดะตะปะธ.  
    ะัะต ะทะฝะฐัะตะฝะธั ะธะผะตัั ะพะดะธะฝะฐะบะพะฒัั ะบะพะดะธัะพะฒะบั:
    
    - **-1** => ะฟะพะดะพะทัะธัะตะปัะฝะพ / ะฟะปะพัะพ (ัะฐััะพ ัะบะฐะทัะฒะฐะตั ะฝะฐ ัะธัะธะฝะณ)  
    - **0** => ะฝะตะนััะฐะปัะฝะพ / ััะตะดะฝะตะต ะทะฝะฐัะตะฝะธะต  
    - **1** => ะฝะพัะผะฐะปัะฝะพ / ัะพัะพัะพ (ัะฐัะฐะบัะตัะฝะพ ะดะปั ะปะตะณะธัะธะผะฝัั ัะฐะนัะพะฒ)
    """)
    
    for feature in base_features:
        with st.expander(f"**{feature}** โ {feature_descriptions[feature]}"):
            st.markdown("### ะงัะพ ะฟัะพะฒะตััะตั ััะพั ะฟัะธะทะฝะฐะบ?")
            st.write(feature_descriptions[feature])
            
            st.markdown("### ะงัะพ ะทะฝะฐัะธั ะบะฐะถะดะพะต ะทะฝะฐัะตะฝะธะต?")
            
            if feature == 'SSLfinal_State':
                st.markdown("""
                - **-1** => ะะตั SSL, ะฟัะพััะพัะตะฝ, ัะฐะผะพะฟะพะดะฟะธัะฐะฝะฝัะน ะธะปะธ ะพั ะฝะตะฝะฐะดัะถะฝะพะณะพ ัะตะฝััะฐ โ **ะพัะตะฝั ะฟะปะพัะพ!**  
                - **0** => ะงะฐััะธัะฝะพ ะฒะฐะปะธะดะฝัะน ัะตััะธัะธะบะฐั  
                - **1** => ะะพะปะฝะพัััั ะฒะฐะปะธะดะฝัะน HTTPS ะพั ะฝะฐะดัะถะฝะพะณะพ ัะตะฝััะฐ โ **ะพัะตะฝั ัะพัะพัะพ**
                """)
                st.caption("ะญัะพ ะพะดะธะฝ ะธะท ัะฐะผัั ะฒะฐะถะฝัั ะฟัะธะทะฝะฐะบะพะฒ ะผะพะดะตะปะธ!")
                
            elif feature == 'URL_of_Anchor':
                st.markdown("""
                - **-1** => ะะฝะพะณะพ ัััะปะพะบ <a>, ะณะดะต ัะตะบัั ะฝะต ัะพะฒะฟะฐะดะฐะตั ั ัะตะฐะปัะฝัะผ URL โ **ะพัะตะฝั ะฟะพะดะพะทัะธัะตะปัะฝะพ**  
                - **0** => ะกัะตะดะฝะตะต ะบะพะปะธัะตััะฒะพ  
                - **1** => ะัะต ัััะปะบะธ ัะตััะฝัะต ะธ ะฒะตะดัั ััะดะฐ, ะบัะดะฐ ัะบะฐะทะฐะฝะพ
                """)
                st.caption("ะกะฐะผัะน ะฒะฐะถะฝัะน ะฟัะธะทะฝะฐะบ ะฟะพ ะฒะฐะถะฝะพััะธ ะฒ ะผะพะดะตะปะธ!")
                
            else:
                st.markdown("""
                - **-1** => ะะพะดะพะทัะธัะตะปัะฝะพะต ะทะฝะฐัะตะฝะธะต (ะฟะพะฒััะฐะตั ัะธัะบ ัะธัะธะฝะณะฐ)  
                - **0** => ะะตะนััะฐะปัะฝะพะต  
                - **1** => ะะพัะผะฐะปัะฝะพะต, ะฑะตะทะพะฟะฐัะฝะพะต ะทะฝะฐัะตะฝะธะต
                """)
            
            st.caption("ะงะตะผ ะฑะพะปััะต ะฟัะธะทะฝะฐะบะพะฒ ั -1 โ ัะตะผ ะฒััะต ะฒะตัะพััะฝะพััั ัะธัะธะฝะณะฐ.")

# โโโ ะ ะผะพะดะตะปะธ ========================================================
elif page == "ะ ะผะพะดะตะปะธ":
    st.title("โน๏ธ ะ ะผะพะดะตะปะธ")
    
    st.markdown("""
    ### ะัะฝะพะฒะฝัะต ัะฐัะฐะบัะตัะธััะธะบะธ ะผะพะดะตะปะธ
    
    - **ะะปะณะพัะธัะผ:** CatBoost (ะณัะฐะดะธะตะฝัะฝัะน ะฑัััะธะฝะณ)  
    - **ะะฐัะฐัะตั:** ~11 055 ะฟัะธะผะตัะพะฒ  
    - **ะัะธะทะฝะฐะบะพะฒ:** 22 ะฑะฐะทะพะฒัั + 4 ะฝะพะฒัั (ะธะฝะถะตะฝะตัะฝัั)  
    - **ROC-AUC:** **0.995**  
    - **Accuracy:** ~**97%**  
    - **Recall ะฟะพ ัะธัะธะฝะณั:** **95โ96%** (ะณะปะฐะฒะฝะฐั ัะตะปั โ ะฝะต ะฟัะพะฟัััะธัั ะพะฟะฐัะฝัะต ัะฐะนัั!)
    
    **ะขะพะฟ-ะฒะฐะถะฝัะต ะฟัะธะทะฝะฐะบะธ (ะฟะพ ัะฑัะฒะฐะฝะธั):**
    1. URL_of_Anchor  
    2. SSLfinal_State  
    3. Prefix_Suffix  
    4. SFH  
    5. Links_in_tags  
    6. web_traffic
    
    ะะพะดะตะปั ัะฟะตัะธะฐะปัะฝะพ ะฝะฐัััะพะตะฝะฐ ะฝะฐ **ะฒััะพะบะธะน recall** ะฟะพ ะบะปะฐััั ัะธัะธะฝะณะฐ.
    """)
    
    st.markdown("---")
    st.caption("ะฃะดะฐัะธ ะธ ะฑะตะทะพะฟะฐัะฝะพะณะพ ัะตััะธะฝะณะฐ ะฒ ะธะฝัะตัะฝะตัะต! ๐๐")

