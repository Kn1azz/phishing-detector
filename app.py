import streamlit as st
import pandas as pd
from catboost import CatBoostClassifier
import os

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(page_title="Phishing Detector üõ°Ô∏è", page_icon="üõ°Ô∏è", layout="wide")

# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
st.title("üõ°Ô∏è Phishing Detector ‚Äî –ó–∞—â–∏—Ç–∞ –æ—Ç –§–∏—à–∏–Ω–≥–∞")
st.markdown("""
–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–∞–π—Ç —Ñ–∏—à–∏–Ω–≥–æ–≤—ã–º (–æ–ø–∞—Å–Ω—ã–º) –∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.  
–ú–æ–¥–µ–ª—å –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ CatBoost –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª .cbm.  
**–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –º–µ–Ω—é —Å–ª–µ–≤–∞.**
""")

# –°–ø–∏—Å–æ–∫ —Ñ–∏—á –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–¥–ª—è –º–æ–¥–µ–ª–∏) ‚Äî –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–∏ —Ç–æ—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
FEATURES_EN = [
    'having_IP_Address', 'URL_Length', 'Shortining_Service', 'having_At_Symbol',
    'double_slash_redirecting', 'Prefix_Suffix', 'having_Sub_Domain', 'SSLfinal_State',
    'Domain_registeration_length', 'Favicon', 'port', 'HTTPS_token', 'Request_URL',
    'URL_of_Anchor', 'Links_in_tags', 'SFH', 'Submitting_to_email', 'Abnormal_URL',
    'Redirect', 'on_mouseover', 'RightClick', 'popUpWidnow', 'Iframe', 'age_of_domain',
    'DNSRecord', 'web_traffic', 'Page_Rank', 'Google_Index', 'Links_pointing_to_page',
    'Statistical_report', 'total_red_flags', 'ssl_anchor_interaction', 'no_ssl_short_reg', 'subdomain_prefix'
]

# –ü–µ—Ä–µ–≤–æ–¥ —Ñ–∏—á –Ω–∞ —Ä—É—Å—Å–∫–∏–π
FEATURES_RU = {
    'having_IP_Address': '–ù–∞–ª–∏—á–∏–µ IP-–∞–¥—Ä–µ—Å–∞ –≤ URL',
    'URL_Length': '–î–ª–∏–Ω–∞ URL',
    'Shortining_Service': '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫',
    'having_At_Symbol': '–ù–∞–ª–∏—á–∏–µ —Å–∏–º–≤–æ–ª–∞ @ –≤ URL',
    'double_slash_redirecting': '–î–≤–æ–π–Ω–æ–π —Å–ª–µ—à –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞',
    'Prefix_Suffix': '–ü—Ä–µ—Ñ–∏–∫—Å/—Å—É—Ñ—Ñ–∏–∫—Å –≤ –¥–æ–º–µ–Ω–µ (–¥–µ—Ñ–∏—Å)',
    'having_Sub_Domain': '–ù–∞–ª–∏—á–∏–µ —Å—É–±–¥–æ–º–µ–Ω–∞',
    'SSLfinal_State': '–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞',
    'Domain_registeration_length': '–î–ª–∏–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ–º–µ–Ω–∞',
    'Favicon': '–§–∞–≤–∏–∫–æ–Ω —Å –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ–º–µ–Ω–∞',
    'port': '–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç',
    'HTTPS_token': '–¢–æ–∫–µ–Ω HTTPS –≤ URL',
    'Request_URL': 'URL –∑–∞–ø—Ä–æ—Å–∞',
    'URL_of_Anchor': 'URL —è–∫–æ—Ä—è',
    'Links_in_tags': '–°—Å—ã–ª–∫–∏ –≤ —Ç–µ–≥–∞—Ö',
    'SFH': 'Server Form Handler',
    'Submitting_to_email': '–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –Ω–∞ email',
    'Abnormal_URL': '–ê–Ω–æ–º–∞–ª—å–Ω—ã–π URL',
    'Redirect': '–†–µ–¥–∏—Ä–µ–∫—Ç—ã',
    'on_mouseover': 'On mouseover –≤ JS',
    'RightClick': '–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∞–≤–æ–≥–æ –∫–ª–∏–∫–∞',
    'popUpWidnow': '–ü–æ–ø–∞–ø-–æ–∫–Ω–∞',
    'Iframe': 'Iframe —Å –Ω—É–ª–µ–≤–æ–π –≥—Ä–∞–Ω–∏—Ü–µ–π',
    'age_of_domain': '–í–æ–∑—Ä–∞—Å—Ç –¥–æ–º–µ–Ω–∞',
    'DNSRecord': 'DNS-–∑–∞–ø–∏—Å—å',
    'web_traffic': '–í–µ–±-—Ç—Ä–∞—Ñ–∏–∫ (Alexa rank)',
    'Page_Rank': 'Google Page Rank',
    'Google_Index': '–ò–Ω–¥–µ–∫—Å Google',
    'Links_pointing_to_page': '–°—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É',
    'Statistical_report': '–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç (PhishTank)',
    'total_red_flags': '–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∞—Å–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤',
    'ssl_anchor_interaction': '–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ SSL –∏ —è–∫–æ—Ä—è',
    'no_ssl_short_reg': '–ù–µ—Ç SSL + –∫–æ—Ä–æ—Ç–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–æ–º–µ–Ω–∞',
    'subdomain_prefix': '–°—É–±–¥–æ–º–µ–Ω + –ø—Ä–µ—Ñ–∏–∫—Å'
}

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
model_path = 'phishing_detector_catboost.cbm'
if os.path.exists(model_path):
    model = CatBoostClassifier()
    model.load_model(model_path)
else:
    st.error("–§–∞–π–ª –º–æ–¥–µ–ª–∏ 'phishing_detector_catboost.cbm' –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.")

# –ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
page = st.sidebar.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É", ["–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞", "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤", "–û –º–æ–¥–µ–ª–∏"])

if page == "–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞":
    st.header("üìù –í–≤–µ–¥–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å–∞–π—Ç–∞")
    st.markdown("""
    –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–∞–π—Ç–∞ –Ω–∏–∂–µ.  
    –ú–æ–¥–µ–ª—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –¥–∞—Å—Ç –ø—Ä–æ–≥–Ω–æ–∑ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é.  
    """)

    inputs = {}
    col1, col2 = st.columns(2)
    for i, feat_en in enumerate(FEATURES_EN):
        feat_ru = FEATURES_RU.get(feat_en, feat_en)
        with col1 if i % 2 == 0 else col2:
            inputs[feat_en] = st.selectbox(feat_ru, [-1, 0, 1], index=1)

    if st.button("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∞–π—Ç", type="primary"):
        with st.spinner("–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∞–π—Ç..."):
            df_input = pd.DataFrame([inputs])
            proba = model.predict_proba(df_input)[0][1]  # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∞ 1 (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º 1 = —Ñ–∏—à–∏–Ω–≥)

            st.subheader("–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞")
            if proba >= 0.5:
                st.error(f"‚ö†Ô∏è –§–ò–®–ò–ù–ì–û–í–´–ô –°–ê–ô–¢! –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: **{proba * 100:.2f}%**")
                st.write("**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–µ –≤–≤–æ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ! –≠—Ç–æ –æ–ø–∞—Å–Ω–æ.")
            else:
                st.success(f"‚úÖ –ë–ï–ó–û–ü–ê–°–ù–´–ô –°–ê–ô–¢! –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ñ–∏—à–∏–Ω–≥–∞: **{proba * 100:.2f}%**")
                st.write("**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü–æ—Ö–æ–∂–µ –Ω–∞ –ª–µ–≥–∏—Ç–∏–º–Ω—ã–π —Å–∞–π—Ç, –Ω–æ –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã.")

            # –ö—Ä–∞—Å–∏–≤–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
            st.progress(proba)
            st.caption(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ñ–∏—à–∏–Ω–≥–∞: {proba * 100:.2f}% | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: {(1 - proba) * 100:.2f}%")

elif page == "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤":
    st.header("üìñ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤")
    st.markdown("""
    –ó–¥–µ—Å—å –æ–±—ä—è—Å–Ω–µ–Ω–æ, —á—Ç–æ –∑–Ω–∞—á–∏—Ç –∫–∞–∂–¥—ã–π –ø—Ä–∏–∑–Ω–∞–∫ –∏ —á—Ç–æ –æ–±–æ–∑–Ω–∞—á–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è.  
    - **-1**: –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ (–∫—Ä–∞—Å–Ω—ã–π —Ñ–ª–∞–≥, –ø–æ–≤—ã—à–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ñ–∏—à–∏–Ω–≥–∞)  
    - **0**: –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ (–Ω–µ –≤–ª–∏—è–µ—Ç —Å–∏–ª—å–Ω–æ)  
    - **1**: –ù–æ—Ä–º–∞–ª—å–Ω–æ (–±–µ–∑–æ–ø–∞—Å–Ω–æ, —Å–Ω–∏–∂–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ñ–∏—à–∏–Ω–≥–∞)  
    """)

    for feat_en, desc in FEATURES_RU.items():
        with st.expander(desc):
            st.write(f"**–ß—Ç–æ –∑–Ω–∞—á–∏—Ç:** {desc}")
            st.write("**-1:** –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Ç SSL –∏–ª–∏ IP –≤ URL)")
            st.write("**0:** –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ (—Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)")
            st.write("**1:** –ù–æ—Ä–º–∞–ª—å–Ω–æ (–≤–∞–ª–∏–¥–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Å–∞–π—Ç –∏ —Ç.–¥.)")

elif page == "–û –º–æ–¥–µ–ª–∏":
    st.header("ü§ñ –û –º–æ–¥–µ–ª–∏ CatBoost")
    st.markdown("""
    –ú–æ–¥–µ–ª—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ CatBoost ‚Äî –º–æ—â–Ω–æ–º –∞–ª–≥–æ—Ä–∏—Ç–º–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ –±—É—Å—Ç–∏–Ω–≥–∞.  
    CatBoost –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ (-1/0/1) –∏ –ª–æ–≤–∏—Ç –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
    """)

    st.subheader("–ö–ª—é—á–µ–≤—ã–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã")
    st.markdown("""
    - iterations: 1500 (—Å early_stopping)  
    - learning_rate: 0.035  
    - depth: 6  
    - class_weights: [1.0, 1.25] (–±–æ–ª—å—à–µ –≤–µ—Å–∞ —Ñ–∏—à–∏–Ω–≥—É)  
    - eval_metric: 'Recall' (—Ñ–æ–∫—É—Å –Ω–∞ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤)
    """)

    st.subheader("–û—Ü–µ–Ω–∫–∏ –º–æ–¥–µ–ª–∏")
    st.markdown("""
    - **Recall (—Ñ–∏—à–∏–Ω–≥)**: **0.966** (–ø—Ä–æ–ø—É—â–µ–Ω–æ –≤—Å–µ–≥–æ 32 –∏–∑ 951)  
    - **Precision**: **0.982** (–º–∞–ª–æ –ª–æ–∂–Ω—ã—Ö —Ç—Ä–µ–≤–æ–≥)  
    - **Accuracy**: **0.98**  
    - **ROC-AUC**: **0.9967** (–ø–æ—á—Ç–∏ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤)  
    - **FN (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ñ–∏—à–∏–Ω–≥–∏)**: **32** (–Ω–∞ –ø–æ—Ä–æ–≥–µ 0.5)
    """)

    st.subheader("–¢–æ–ø-5 –≤–∞–∂–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤")
    st.markdown("""
    1. SSLfinal_State: 26.14%  
    2. URL_of_Anchor: 12.77%  
    3. web_traffic: 7.48%  
    4. Links_in_tags: 6.29%  
    5. ssl_anchor_interaction: 5.92%
    """)

    st.success("–ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é ‚Äî –±—ã—Å—Ç—Ä–æ –∏ —Ç–æ—á–Ω–æ! üåü")

# –§—É—Ç–µ—Ä
st.sidebar.markdown("---")
st.sidebar.write("–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ Muhammad –≤ –î—É—à–∞–Ω–±–µ, 2026")
st.sidebar.write("GitHub: github.com/kn1azz/phishing-detector")
